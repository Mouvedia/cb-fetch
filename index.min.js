!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports&&exports&&!exports.nodeType?"object"==typeof module&&module&&module.exports?module.exports=t():exports["default"]=t():"function"==typeof YUI&&YUI.add?YUI.add("cb-fetch",function(e){e["default"]=t()},"0.9.0-alpha.9"):e.request=t()}(function(){try{return Function("return this")()||(0,eval)("this")}catch(e){return self}}(),function(){function e(e){self.console&&self.console.error&&self.console.error(e.message||e.description)}function t(e,t){throw t=t||"TypeError",new(self[t]||self.Error)(e)}function r(f){if(self.XMLHttpRequest/*@cc_on@if(@_jscript_version<9)&&y.method!=='PATCH'@else &&y.method!=='PATCH'&&document.documentMode>=9@end@*/)return new self.XMLHttpRequest(f);/*@cc_on@if(@_jscript_version>=5)else{var p=['Msxml2.XMLHTTP.6.0','Msxml2.XMLHTTP.3.0','Microsoft.XMLHTTP'];for(var i=0;i<p.length;++i){try{return new self.ActiveXObject(p[i])}catch(e){}}}@end@*/}function o(){var e=/^[^#?]+\?/.test(y.url)?"&":"?",r=self.encodeURIComponent;if(y.url=y.url.split("#")[0],self.URLSearchParams&&"[object URLSearchParams]"===Object.prototype.toString.call(y.parameters)&&(y.parameters=y.parameters.toString()),String.isString(y.parameters)){var o,s,n=y.parameters.split("&"),a=n.length;for(s=0;a>s;++s)o=n[s].split("="),y.url+=(s?"&":e)+r(o[0])+"="+r(o[1])}else if("object"==typeof y.parameters)for(var u in y.parameters)y.url+=e+r(u)+"="+r(y.parameters[u]),e="&";else t()}function s(){var e,t=y.headers;if(self.Headers&&"[object Headers]"===Object.prototype.toString.call(t))t.get("content-type")||t.set("Content-Type","application/x-www-form-urlencoded");else{for(e in t)if("content-type"===e.toLowerCase()&&t[e])return;t["Content-Type"]="application/x-www-form-urlencoded"}}function n(e){var t,r,o,s,n,a,u={};if(self.Headers&&"[object Headers]"===Object.prototype.toString.call(y.headers)){if(y.headers.entries)for(r=y.headers.entries();!(o=r.next()).done;)s=o.value[0],n=o.value[1],a="Cookie"===s?"; ":", ",n&&(u[s]=u[s]?u[s]+a+n:n)}else for(t in y.headers)a="Cookie"===t?"; ":", ",y.headers[t]&&(u[t]=(u[t]?u[t]+a:"")+y.headers[t]);for(t in u)e.setRequestHeader(t,u[t]);!u.Authorization&&y.username&&e.setRequestHeader("Authorization","Basic "+self.btoa(y.username+":"+(y.password||"")))}function a(e){return"string"==typeof e.responseType?"text"===e.responseType?!!e.responseText:"document"===e.responseType||"msxml-document"===e.responseType?!!e.responseXML:!!e.response:"string"==typeof e.responseText?!!e.responseText:"object"==typeof e.responseXML?!!e.responseXML:!1}function u(t){var o,s=r(t.XHR),u=t.success,c=t.error;if(self.attachEvent&&(o=function(){s.onreadystatechange=function(){},s.abort()},self.attachEvent("onunload",o)),s.onreadystatechange=function(){if(4==s.readyState){self.detachEvent&&self.detachEvent("onunload",o),s.onreadystatechange=function(){};try{s.status>=200&&s.status<300||304==s.status||1223==s.status||0===s.status&&a(s)?u(s):c&&c(s)}catch(t){e(t),c&&c(s)}s=null}},s.open(y.method,y.url,!0,y.username,y.password),y.responseType)try{s.responseType=y.responseType}catch(i){e(i)}"include"===y.credentials&&"boolean"==typeof s.withCredentials&&(s.withCredentials=!0),y.timeout&&"number"==typeof s.timeout&&(s.timeout=y.timeout),y.mediaType&&s.overrideMimeType&&s.overrideMimeType(y.mediaType),s.setRequestHeader&&n(s),s.send(/^(POST|PUT|PATCH)$/.test(y.method)?y.body||"":null)}function c(e){return Promise[e.ok||304==e.status?"resolve":"reject"](e)}function i(e){switch(y.responseType){case"text":case"moz-chunked-text":case"":return e.text();case"json":return e.json();case"arraybuffer":case"moz-chunked-arraybuffer":return e.arrayBuffer();case"blob":case"moz-blob":return e[self.Response.prototype.blob?"blob":"valueOf"]();case"formdata":if(self.Response.prototype.formData)return e.formData();default:return e}}function p(e){var t;return/^([^#?]+:)?\/\/[^\/]+@/.test(e)?(t=e.split("//")[1].split("@")[0].split(":"),y.username||(y.username=t[0],y.password=t[1]),e.replace(/\/\/[^\/]+@/,"//")):e}function l(e){String.isString(e.href)?(y.username||(y.username=e.username,y.password=e.password),e.username=e.password="",y.url=e.href):t()}function f(e){String.isString(e)?y.url=p(e):self.URL&&"[object URL]"===Object.prototype.toString.call(e)?l(e):"object"==typeof e&&e?(y=e,self.URL&&"[object URL]"===Object.prototype.toString.call(y.url)?l(y.url):String.isString(y.url)&&(y.url=p(y.url))):t()}function d(e){m[e]=function(t){var r=/^(patch|post|put)$/.test(e),o=r?"send":"query",s=r?"body":"parameters",n={};return self.URL&&"[object URL]"===Object.prototype.toString.call(t)?l(t):String.isString(t)&&(y.url=p(t)),y.method=e.toUpperCase(),n[o]=function(e){return y[s]=e||y[s],{done:m.done}},n.done=m.done,n}}var m={},y={},h=function(e){return f(e),y.url=y.url||self.location.href,y.method=y.method&&y.method.toUpperCase()||"GET",y.mode=y.mode||"same-origin",y.credentials=y.credentials||"same-origin",y.headers=y.headers||{},y.username=y.username||null,y.password=y.password||null,y.mediaType=y.mediaType||y.contentType||y.MIMEType,m};return m.done=function(e,r){var n="object"==typeof e&&e||{success:e,error:r};"function"!=typeof n.success&&t("A success callback must be provided."),"undefined"!=typeof n.error&&"function"!=typeof n.error&&t("The failure callback must be a function."),/^(POST|PUT|PATCH)$/.test(y.method)?s():y.parameters&&o(),self.fetch&&!self.fetch.nodeType?self.fetch(y.url,y).then(c).then(i).then(n.success,n.error):u(n)},d("post"),d("put"),d("patch"),d("get"),d("head"),d("delete"),h});