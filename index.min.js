!function(e,t){"function"==typeof define&&define.amd?define(["@string/isstring"],t):"object"==typeof exports&&exports&&!exports.nodeType?(require("@string/isstring"),"object"==typeof module&&module&&module.exports?module.exports=t():exports["default"]=t()):"function"==typeof YUI&&YUI.add?YUI.add("cb-fetch",function(e){e["default"]=t()},"1.5.0"):e.request?self.console&&self.console.warn&&self.console.warn("Module registration aborted! %O already exists.",e.request):e.request=t()}(function(){try{return Function("return this")()||(0,eval)("this")}catch(e){return self}}(),function(){return function(e){function t(e){self.console&&self.console.error&&self.console.error(e.message||e.description||e)}function n(e,t){throw t=t||"TypeError",new(self[t]||self.Error)(e)}function o(){var a="omit"===z.credentials?{mozAnon:!0}:void 0,f=/^(GET|POST|HEAD|PUT|DELETE|MOVE|PROPFIND|PROPPATCH|MKCOL|COPY|LOCK|UNLOCK|OPTIONS)$/;if(self.XMLHttpRequest/*@cc_on@if(@_jscript_version<9)&&f.test(z.method)@else &&(self.WorkerGlobalScope||document.documentMode>=9||f.test(z.method))@end@*/)return a&&self.AnonXMLHttpRequest?new AnonXMLHttpRequest:new XMLHttpRequest(a);/*@cc_on@if(@_jscript_version>=5)else{var p=['Msxml2.XMLHTTP.6.0','Msxml2.XMLHTTP.3.0','Microsoft.XMLHTTP'];for(var i=0;i<p.length;++i){try{return new ActiveXObject(p[i])}catch(err){}}}@end@*/}function r(){var e=/^[^#?]+\?/.test(z.url)?"&":"?",t=self.encodeURIComponent;if(z.url=z.url.split("#")[0],self.URLSearchParams&&"[object URLSearchParams]"===Object.prototype.toString.call(z.parameters)&&(z.parameters=z.parameters.toString()),z.parameters&&String.isString(z.parameters)){var n,o,r=z.parameters.split("&"),s=r.length;for(o=0;o<s;++o)n=r[o].split("="),z.url+=(o?"&":e)+t(n[0])+"="+t(n[1])}else if("object"==typeof z.parameters)for(var a in z.parameters)z.url+=e+t(a)+"="+t(z.parameters[a]),e="&"}function s(){var e=z.headers,t=z.method,n=/^(HEAD|OPTIONS|PROPFIND|REPORT|SEARCH)$/.test(t),o=/^(PUT|MERGE|PATCH|DELETE)$/.test(t);z.method=n?"GET":"POST",self.Headers&&"[object Headers]"===Object.prototype.toString.call(e)?(e.set("X-HTTP-Method-Override",t),e.set("X-METHOD-OVERRIDE",t),o&&e.set("X-HTTP-Method",t)):(e["X-HTTP-Method-Override"]=t,e["X-METHOD-OVERRIDE"]=t,o&&(e["X-HTTP-Method"]=t))}function a(e,t){for(var n in e)if(n.toLowerCase()===t.toLowerCase()&&e[n])return e[n]}function u(e,t){var n=z.headers;self.Headers&&"[object Headers]"===Object.prototype.toString.call(n)?n.get(e)||n.set(e,t):a(n,e)||(n[e]=t)}function i(e,t,n){var o="cookie"===t.toLowerCase()?"; ":", ";n&&(e[t]=e[t]?e[t]+o+n:n)}function c(e){var t,n,o={};if(e.entries)for(t=e.entries();!(n=t.next()).done;)i(o,n.value[0],n.value[1]);return o}function l(e){var t,n;if("cors"!==z.mode&&u("X-Requested-With","XMLHttpRequest"),self.URLSearchParams&&"[object URLSearchParams]"===Object.prototype.toString.call(z.body)&&u("Content-Type","application/x-www-form-urlencoded"),self.Headers&&"[object Headers]"===Object.prototype.toString.call(z.headers))t=c(z.headers);else{t={};for(n in z.headers)i(t,n,z.headers[n])}for(n in t)e.setRequestHeader(n,t[n])}function d(e){if(e)if(e.parseError&&0!=e.parseError)t("XML Parsing Error: "+e.parseError.reason);else{if(!e.documentElement||"parsererror"!==e.documentElement.tagName)return e;t(e.documentElement.firstChild.data.split("\n",1)[0])}return null}function f(e){if("string"==typeof e.responseType)switch(e.responseType){case"text":case"":return e.responseText;case"document":case"msxml-document":return d(e.responseXML);default:return"undefined"==typeof e.response?e.responseText:e.response}return"object"==typeof e.responseXML&&e.responseXML?d(e.responseXML):"string"==typeof e.responseText?e.responseText:void 0}function p(e){return e.status>=200&&e.status<300||304==e.status||1223==e.status||0==e.status&&f(e)?"success":"error"}function m(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e),n.set(t,e.byteLength),t.length?n:n.buffer}function h(e,t){return e.byteLength?m(t,e):e.length?t+e:void 0}function y(e,t){return e.length?e.slice(t.length):e.slice?e.slice(t.size):e.mozSlice?e.mozSlice(t.size):void 0}function g(e){function t(e){return"boolean"!=typeof r&&(r=e.totalSize?0x10000000000000000!==e.totalSize:!!e.lengthComputable),{chunk:a,aggregate:u,loaded:e.loaded||e.position,total:r?e.total||e.totalSize:0,lengthComputable:r}}var n,o,r,s,a,u;self.AnonXMLHttpRequest&&!z.responseMediaType&&(z.responseMediaType="application/octet-stream"),e.onprogress=function(r){var i="undefined"==typeof e.response?e.responseText:e.response;"boolean"!=typeof s&&(s="string"==typeof e.responseType&&~e.responseType.indexOf("chunked")),u?(a=s?i:y(i,u),u=s?h(i,u):i):a=u=i,(r.loaded||r.position)&&(B.download(t(r)),n=r.loaded,o=r.total)},e.onload=function(t){var r="undefined"==typeof e.response?e.responseText:e.response,s=t.loaded||o||r&&r.size||+X("content-length");"number"!=typeof t.loaded||s<=n||B.download({chunk:u?r.slice(u.length):r,aggregate:r,loaded:s,total:s,lengthComputable:!!s})}}function b(e,t,n){B.download({chunk:e,aggregate:t,loaded:t.length,total:n||0,lengthComputable:!!n})}function T(e){var t=self.document.createElement("a");return t.href=e,self.location.protocol+t.href.replace(/^https?:/,"")}function M(){function e(e,n){k[e]&&k[e](n),B.loadend&&B.loadend(),t=function(){}}var t,n,o=self.XDomainRequest.create();return t=function(){o.abort(),e("abort")},o.ontimeout=function(){e("timeout")},o.onerror=function(){e("error",{instance:o})},o.onprogress=B.download?function(){var e=o.responseText;b(n?e.slice(n):e,e),n=e.length}:function(){},o.onload=function(){k.success&&(N.headers={"Content-Type":o.contentType},N.body=w(o)),e("success",N)},z.timeout&&(o.timeout=z.timeout),o.open(z.method,T(z.url)),N.instance=o,o.send(),function(){t()}}function v(){function e(e,t){k[e]&&k[e](t),!u&&B.loadend&&B.loadend()}function n(e){r&&clearTimeout(r),s&&(e&&"timeout"===e.type?k.timeout&&k.timeout():a||k.abort&&k.abort(),s.onreadystatechange=function(){},s.abort(),u||a||B.loadend&&B.loadend())}var r,s=o(),a="undefined"!=typeof s.onabort,u="undefined"!=typeof s.onloadend;if(self.attachEvent&&attachEvent("onunload",n),s.onreadystatechange=function(){if(4==s.readyState){r&&clearTimeout(r),self.detachEvent&&detachEvent("onunload",n),s.onreadystatechange=function(){};try{e(p(s),S(s))}catch(err){t(err),e("error",{instance:s})}s=null}},B.download&&"undefined"!=typeof s.onprogress&&g(s),a&&(s.onabort=function(){e("abort")}),B.loadend&&u&&(s.onloadend=B.loadend),z.multipart&&"boolean"==typeof s.multipart&&(s.multipart=!0),s.open(z.method,z.url,!0),z.caching&&"string"==typeof s.msCaching&&(s.msCaching=z.caching),z.responseType)try{s.responseType=z.responseType}catch(err){t(err)}return"include"===z.credentials&&"boolean"==typeof s.withCredentials&&(s.withCredentials=!0),z.responseMediaType&&s.overrideMimeType&&s.overrideMimeType(z.responseMediaType),s.setRequestHeader&&l(s),z.timeout&&("number"==typeof s.timeout?(s.timeout=z.timeout,s.ontimeout=function(){e("timeout")}):r=setTimeout(function(){n({type:"timeout"})},z.timeout)),s.send(/^(HEAD|GET)$/.test(z.method)?null:z.body||""),n}function E(){var e=$&&new AbortController;return e&&(k.abort&&e.signal.addEventListener("abort",k.abort),z.signal=e.signal),self.fetch(z.url,z).then(D).then(x).then(R).then(L).then(function(t){e&&k.abort&&e.signal.removeEventListener("abort",k.abort),t.ok||304==t.status?k.success&&k.success(N):k.error&&k.error(N),B.loadend&&B.loadend()})["catch"](function(n){e&&e.signal.aborted&&B.loadend&&B.loadend(),t(n)}),e?e.abort.bind(e):n.bind(null,"An abort callback must be provided.")}function L(e){return N.body=e,N.instance}function R(e){switch(z.responseType){case"text":case"":return e.text();case"document":return e.text().then(function(e){return C(e)});case"json":return e.json().then(function(e){return e})["catch"](function(){return e.body||null});case"arraybuffer":return e.arrayBuffer();case"blob":if(self.Response.prototype.blob)return e.blob();break;case"formdata":if(self.Response.prototype.formData)return e.formData()}return e.body||null}function x(e){function t(e){if(e.done)return o;var a=e.value;return n=n?m(n,a):a,b(a,n,s),r.read().then(t)}if(!B.download)return e;var n,o=e.clone(),r=e.body.getReader(),s=+e.headers.get("Content-Length");return r.read().then(t)}function D(e){return N.instance=e,N.headers=c(e.headers),N.statusCode=e.status,N.statusText=e.statusText,N.url=e.url,e}function S(e){N.instance=e,N.headers=P(e),N.statusCode=1223===e.status?204:e.status;try{N.statusText=1223===e.status?"No Content":e.statusText}catch(err){N.statusText=""}return N.url=e.responseURL,N.body=w(e),N}function w(e){var t=f(e);switch(z.responseType){case"document":case"msxml-document":if("string"==typeof t)return C(t);break;case"json":if("object"!=typeof t)try{return self.JSON.parse(t)}catch(err){}}return t}function C(e){var t,n,o,r=["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XMLDOM","MSXML.DOMDocument"],s=r.length,a=z.XSLPattern?"XSLPattern":"XPath",u=self.document&&self.document.implementation,i=H(),c=null;if(u&&u.createLSParser){t=u.createLSParser(1,null),n=u.createLSInput(),n.stringData=e;try{return t.parse(n)}catch(err){}}else if(self.DOMParser){try{c=(new DOMParser).parseFromString(e,i)}catch(err){}if(!c&&"text/html"===i)return O(e);if(c&&c.getElementsByTagName("parsererror").length)return null}else if(self.ActiveXObject)for(o=0;o<s;++o)try{return c=new ActiveXObject(r[o]),"MSXML2.DOMDocument.3.0"===r[o]&&c.setProperty("SelectionLanguage",a),c.async=!1,c.loadXML(e)?c:null}catch(err){}return c}function O(e){var t,n,o=self.document.implementation;o.createHTMLDocument?t=o.createHTMLDocument(null,"",null):(n=o.createDocumentType("html","",""),t=o.createDocument("","html",n));try{t.documentElement.innerHTML=e}catch(err){t=new ActiveXObject("htmlfile"),t.open(),t.write(e),t.close()}return t}function H(){var e=z.responseMediaType||a(N.headers,"Content-Type");switch(e){case"text/html":case"text/xml":case"application/xml":case"application/xhtml+xml":case"image/svg+xml":break;default:e="text/xml"}return e}function X(e){try{return N.instance.getResponseHeader(e)}catch(err){}}function P(e){var t,n,o,r,s,a,u,i={},c=e.getAllResponseHeaders(),l=!c&&X("Access-Control-Expose-Headers");if("cors"===z.mode&&null===c){if(i["Cache-Control"]=e.getResponseHeader("Cache-Control"),i["Content-Language"]=e.getResponseHeader("Content-Language"),i["Content-Type"]=e.getResponseHeader("Content-Type"),i.Expires=e.getResponseHeader("Expires"),i["Last-Modified"]=e.getResponseHeader("Last-Modified"),i.Pragma=e.getResponseHeader("Pragma"),l&&"*"!==l)for(l=l.replace(/\s+/g,"").split(","),u=0,o=l.length;u<o;++u)s=l[u],(a=X(s))&&(i[s]=a)}else if(c)for(t=c.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/),o=t.length-1,u=0;u<o;++u)n=t[u],(r=n.indexOf(": "))>0&&(s=n.substring(0,r).toLowerCase(),a=n.substring(r+2),i[s]=a);return i}function j(e){if(/^([^#?]+:)?\/\/[^\/]+@/.test(e)){var t=e.split("//")[1].split("@")[0].split(":");return z.username||(z.username=t[0],z.password=t[1]),e.replace(/\/\/[^\/]+@/,"//")}return e}function A(e){String.isString(e)?z.url=j(e):self.URL&&"[object URL]"===Object.prototype.toString.call(e)&&(z.username||(z.username=e.username,z.password=e.password),z.url=/\?$/.test(e.href)?e.href.slice(0,-1):e.href)}function q(){var e=z.method&&z.method.toUpperCase()||"GET",t=(z.body?z.body.ownerDocument||z.body:0).documentElement;return/^(PROPPATCH|ORDERPATCH|ACL|REPORT|BIND|UNBIND|REBIND|UPDATE|LABEL|MERGE|MKREDIRECTREF|UPDATEREDIRECTREF)$/.test(e)&&!t&&n("The "+e+" method requires an XML body."),e}function U(e){I[e]=function(t){var n=!/^(get|head|delete)$/.test(e),o=n?"send":"query",r=n?"body":"parameters",s={};return t&&A(t),z.method=e.toUpperCase(),s[o]=function(e){return z[r]=e||z[r],{done:I.done,hook:I.hook}},s.done=I.done,s.hook=I.hook,s}}var k,I={},z={},N={},B={},$=self.Request&&"signal"in Request.prototype,F=self.Response&&"body"in Response.prototype,G="ActiveXObject"in self&&self.navigator.msPointerEnabled,Y=self.document&&"mozFullScreen"in self.document&&!IDBIndex.prototype.count;return I.done=function(e,t){return k="object"==typeof e&&e||{success:e,error:t},z.tunneling&&!/^(POST|GET)$/.test(z.method)&&s(),z.parameters&&r(),z.username&&u("Authorization","Basic "+self.btoa(z.username+":"+(z.password||""))),B.loadstart&&!1===B.loadstart()?function(){}:/^(moz|ms)/.test(z.responseType)?v():"function"!=typeof self.fetch||!$&&k.abort||!F&&B.download?"cors"!==z.mode||!self.document||8!=self.document.documentMode&&9!=self.document.documentMode?v():M():E()},I.hook=function(e,t){return B[e]=t,{hook:I.hook,done:I.done}},U("post"),U("put"),U("patch"),U("get"),U("head"),U("delete"),function(e){e&&(A(e),z.url||e!==Object(e)||(z=e,z.url&&A(z.url)))}(e),function(){z.url=z.url||self.location.href,z.method=q(),z.mode=z.mode||"same-origin",z.credentials=z.credentials||"same-origin",z.headers=z.headers||{},z.username=z.username||null,z.password=z.password||null,z.redirect=z.redirect||"follow","msxml-document"!==z.responseType||G?"json"===z.responseType&&Y&&(z.responseType="moz-json"):z.responseType="document"}(),I}});
